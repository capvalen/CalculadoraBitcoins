<div class="contenedor">
	<div class="" style="color: #fff"><span>Precio de <strong class="mayuscula" id="spanMonedaLtr"></strong> hoy en Perú </span> <span style="margin-left: 20px;">Compra: <strong id="spanPrecioCompraPub"></strong> </span> <span style="">Venta: <strong id="spanPrecioVentaPub"></strong></span> </div>
	<div style="width: 49%;display: inline-block; background-color: #fff; padding-top: 3px; padding-left: 10px; padding-bottom: 16px; ">
		<div class="contenedorInputs" >
		<span style="font-size: 12px;">Tu envías</span><br>
		<input type="number" min="0" id="campoArriba" style="width: 100%; font-size: 20pt;color: #1e3150;font-weight: 700;">
		<span style="font-size: 12px;">Tu recibes</span><br>
		<input type="number" min="0" id="campoAbajo" style="width: 100%; font-size: 20pt;color: #1e3150;font-weight: 700;">
	</div>
	</div>
	<div class="contenedorLabels" style="width: 49%;display: inline-block;margin-left: -3px;">
		<div id="divTop">
			<select style="font-size: 20pt;" id="selectMonedas"> <option value="soles">Soles</option>
				<option value="dolares">Dólares</option>
			</select>
		</div>
		<button id="btnCambiar"><img src="http://www.cambista.com/wp-content/uploads/2018/03/003-refresh-button.svg" style="max-width: 25px;" ></button>
		<div id="divBottom">
			<select style="font-size: 20pt;" id="selectCriptoMonedas">
				<option value="bitcoin">Bitcoin</option><option value="dolares">Dólares</option><option value="ethereum">Ethereum</option><option value="litecoin">Litecoin</option><option value="ripple">Ripple</option>
			</select>
		</div>
	
	</div>
	<div class="resultado" style="background: rgba(62,66,78,.8);color:#fff; width: 98%;"><label>Tipo de cambio usado: <span id="spanTipCambio"></span></label>
	</div>
</div>

<style>
.mayuscula{text-transform: capitalize;}
#btnCambiar{
width: 40px;
height: 40px;
border-radius: 50%;
background-color: #fff;position: absolute; right: 1.8rem; margin-top: -20px;
}
#btnCambiar:hover{cursor: pointer; background-color: #ffbb45; }
.contenedorLabels select{color:#fff;width: 100%;border-radius: 0 4px 0 0;background: #283750;height: 67px;border: 1px solid #192231;}
.contenedorInputs input{border: none;}
.contenedorInputs input[type=number]::-webkit-outer-spin-button,
.contenedorInputs input[type=number]::-webkit-inner-spin-button {-webkit-appearance: none;margin: 0;} 
.contenedorInputs input[type=number] {-moz-appearance:textfield;}
</style>

<script>
jQuery(document).ready(function($) {
	$.precioDolar=3.27;
	/*Si es menor a 350 soles = 35%.. menor a 1500 soles = 25%... mas de 3200 soles =17%
	$.comisionVenta=1.25;
	$.comisionCompra=1.15;*/

	$.JsonMonedas=[];
	/* Captura de valores */
	$.get('https://www.deperu.com/api/rest/cotizaciondolar.json', function(dato){
		$.JsonMonedas.push({'moneda':'dolares', 'compra': dato['Cotizacion'][0].Compra, 'venta': dato['Cotizacion'][0].Venta , simbolo: 'DOL'});
	});
	$.get( "https://api.coinmarketcap.com/v1/ticker/", function(data){
		   var PreOriBtc, PreSolBtc, PreOriBtcCom, PreSolBtcCom,
		   PreOriEth, PreSolEth, PreOriEthCom, PreSolEthCom,
			   PreOriRip, PreSolRip, PreOriRipCom,PreSolRipCom,
			   PreOriNem, PreSolNem, PreOriNemCom, PreSolNemCom,
			   PreOriLit, PreSolLit, PreOriLitCom, PreSolLitCom,
			   PreOriIot, PreSolIot,PreOriIotCom, PreSolIotCom,
			   PreOriDash, PreSolDash,PreSolDashCom, PreOriDashCom,
			   PreOriBts, PreSolBts, PreOriBtsCom, PreSolBtsCom,
			   PreOriStr, PreSolStr, PreOriStrCom, PreSolStrCom,
			   PreOriMonero, PreSolMonero, PreOriMoneroCom, PreSolMoneroCom,
			   PreOriNeo, PreSolNeo, PreOriNeoCom, PreSolNeoCom,
			   PreOriOmisego, PreSolOmisego, PreOriOmisegoCom, PreSolOmisegoCom,
			   PreOriLisk, PreSolLisk, PreOriLiskCom, PreSolLiskCom,
			   PreOriEtherClasic, PreSolEtherClasic, PreOriEtherClasicCom, PreSolEtherClasicCom,
			   PreOriBcash, PreSolBcash, PreOriBcashCom, PreSolBcashCom;
		$.chata=data;
		$.map(data,function(moneda, i){
	   // console.log(moneda);

		if(moneda.id=='bitcoin'){
		  PreOriBtc =moneda.price_usd;
		  PreSolBtc = PreOriBtc*+$.precioDolar;

		 
		  $.JsonMonedas.push({'moneda':'bitcoin', 'precioSol': PreSolBtc, 'precioDol': PreOriBtc , simbolo: 'BTC'});
		}
		if(moneda.id=='ethereum'){
		  PreOriEth =moneda.price_usd;
		  PreSolEth = PreOriEth*$.precioDolar;

		  $.JsonMonedas.push({'moneda':'ethereum', 'precioSol': PreSolEth, 'precioDol': PreOriEth, simbolo: 'ETH' });
		}
		if(moneda.id=='ripple'){
		  PreOriRip =moneda.price_usd;
		  PreSolRip = PreOriRip*$.precioDolar;

		  $.JsonMonedas.push({'moneda':'ripple', 'precioSol': PreSolRip, 'precioDol': PreOriRip, simbolo: 'XRP' });
		}
		if(moneda.id=='nem'){
		  PreOriNem =moneda.price_usd;
		  PreSolNem = PreOriNem*$.precioDolar;

		  $.JsonMonedas.push({'moneda':'nem', 'precioSol': PreSolNem, 'precioDol': PreOriNem, simbolo: 'XEM' });
		}
		if(moneda.id=='litecoin'){
		  PreOriLit =moneda.price_usd;
		  PreSolLit = PreOriLit*$.precioDolar;

		  $.JsonMonedas.push({'moneda':'litecoin', 'precioSol': PreSolLit, 'precioDol': PreOriLit, simbolo: 'LTC' });
		}
		if(moneda.id=='iota'){
		  PreOriIot =moneda.price_usd;
		  PreSolIot = PreOriIot*$.precioDolar;

		  $.JsonMonedas.push({'moneda':'iota', 'precioSol': PreSolIot, 'precioDol': PreOriIot, simbolo: 'MIOTA' });
		}
		if(moneda.id=='dash'){
		  PreOriDash =moneda.price_usd;
		  PreSolDash = PreOriDash*$.precioDolar;

		  $.JsonMonedas.push({'moneda':'dash', 'precioSol': PreSolDash, 'precioDol': PreOriDash, simbolo: 'DASH' });
		}
		if(moneda.id=='bitshares'){
		  PreOriBts =moneda.price_usd;
		  PreSolBts = PreOriBts*$.precioDolar;

		  $.JsonMonedas.push({'moneda':'bitshares', 'precioSol': PreSolBts, 'precioDol': PreOriBts, simbolo: 'BTS' });
		}
		if(moneda.id=='stratis'){
		  PreOriStr =moneda.price_usd;
		  PreSolStr = PreOriStr*$.precioDolar;

		  $.JsonMonedas.push({'moneda':'stratis', 'precioSol': PreSolStr, 'precioDol': PreOriStr, simbolo: 'STRAT' });
		}
		if(moneda.id=='monero'){
		  PreOriMonero =moneda.price_usd;
		  PreSolMonero = PreOriMonero*$.precioDolar;

		  $.JsonMonedas.push({'moneda':'monero', 'precioSol': PreSolMonero, 'precioDol': PreOriMonero, simbolo: 'XMR' });
		}
		if(moneda.id=='neo'){
		  PreOriNeo =moneda.price_usd;
		  PreSolNeo = PreOriNeo*$.precioDolar;

		  $.JsonMonedas.push({'moneda':'neo', 'precioSol': PreSolNeo, 'precioDol': PreOriNeo, simbolo: 'NEO' });
		}
		if(moneda.id=='omisego'){
		  PreOriOmisego =moneda.price_usd;
		  PreSolOmisego = PreOriOmisego*$.precioDolar;

		  $.JsonMonedas.push({'moneda':'omisego', 'precioSol': PreSolOmisego, 'precioDol': PreOriOmisego, simbolo: 'OMG' });
		}
		if(moneda.id=='lisk'){
		  PreOriLisk =moneda.price_usd;
		  PreSolLisk = PreOriLisk*$.precioDolar;

		  $.JsonMonedas.push({'moneda':'lisk', 'precioSol': PreSolLisk, 'precioDol': PreOriLisk, simbolo: 'LSK' });
		}
		if(moneda.id=='ethereum-classic'){
		  PreOriEtherClasic =moneda.price_usd;
		  PreSolEtherClasic = PreOriEtherClasic*$.precioDolar;

		  $.JsonMonedas.push({'moneda':'ethereum-classic', 'precioSol': PreSolEtherClasic, 'precioDol': PreOriEtherClasic, simbolo: 'ETC' });
		}

		if(moneda.id=='bitcoin-cash'){
		  PreOriBcash =moneda.price_usd;
		  PreSolBcash = PreOriBcash*+$.precioDolar;

		  $.JsonMonedas.push({'moneda':'bitcoin-cash', 'precioSol': PreSolBcash, 'precioDol': PreOriBcash , simbolo: 'BCH'});
		}

		
	  });
	console.log($.JsonMonedas);
	$('#btnCambiar').addClass('fisico');
	$('#campoArriba').val(100);
	evaluarQueEstado(true);
	});// Fin de GET
	function valorMoneda(queMoneda){
		var valorAct;
	  	$.map($.JsonMonedas, function(moneda, i){
		if($.JsonMonedas[i].moneda==queMoneda){ //console.log(moneda);
		   valorAct=$.JsonMonedas[i].precioSol;
			return false; 
		}
	  });
	  return valorAct;
	}
	function evaluarQueEstado(queLado) { console.log('fisico '+$('#btnCambiar').hasClass('fisico')); console.log('lado '+queLado);
		if( $('#btnCambiar').hasClass('fisico') ){ //Arriba estan las monedas fisicas
			calculoArriba(queLado);
		}else{ //monedas digitales
			calculoAbajo(queLado);
		}
	}
	function calculoAbajo(queLado) {
		var cantidad=0; var comision=0;var cantidad=0, respu=0;
		//console.log($.isNumeric($('#campoArriba').val()))
		if( $.isNumeric($('#campoArriba').val()) ){cantidad=parseFloat($('#campoArriba').val());}
		var precioMoneda=0;
		if( $('#selectCriptoMonedas').val()!='dolares'){
			precioMoneda=valorMoneda($('#selectCriptoMonedas').val());
		}else{
			precioMoneda=$.JsonMonedas[0].venta;
			comision=1.0112;
		}
		if(cantidad>=3200){ comision=1.17; }
		if(cantidad>=1500 && cantidad<3200){ comision=1.20; }
		if(cantidad>=350 && cantidad<1500){ comision=1.25; }
		if(cantidad>0 && cantidad<350){ comision=1.35; }
		precioMonedaVenta=precioMoneda*comision;
		var precioMonedaCompra=precioMonedaVenta/comision;
		
		if(queLado){
			cantidad=$('#campoArriba').val();
			respu=precioMonedaCompra*cantidad;
			$('#campoAbajo').val(parseFloat(respu).toFixed(6));
		}else{
			cantidad=$('#campoAbajo').val();
			respu=cantidad/precioMonedaCompra;
			$('#campoAbajo').val(parseFloat(respu).toFixed(2));
		}
		$('#spanMonedaLtr').text($('#selectCriptoMonedas').val());
		$('#spanPrecioCompraPub').text('S/. '+ parseFloat(precioMonedaCompra).toFixed(2));
		$('#spanPrecioVentaPub').text('S/. '+ parseFloat(precioMonedaVenta).toFixed(2));
		
		$('#spanTipCambio').text(parseFloat(precioMonedaCompra).toFixed(2));
	}
	function calculoArriba(queLado) { 
		// 1° coger que moneda es
		var cantidad=0; var comision=0;var cantidad=0, respu=0;
		if( $.isNumeric($('#campoArriba').val()) ){cantidad=parseFloat($('#campoArriba').val());}
		var precioMoneda=0;
		if( $('#selectCriptoMonedas').val()!='dolares'){
			precioMoneda=valorMoneda($('#selectCriptoMonedas').val());
		}else{
			precioMoneda=$.JsonMonedas[0].compra;
			comision=1.0112;
		}
		if(cantidad>=3200){ comision=1.17; }
		if(cantidad>=1500 && cantidad<3200){ comision=1.20; }
		if(cantidad>=350 && cantidad<1500){ comision=1.25; }
		if(cantidad>0 && cantidad<350){ comision=1.35; }
		precioMonedaVenta=precioMoneda*comision;
		var precioMonedaCompra=precioMoneda/comision;
		
		if(queLado){
			cantidad=$('#campoArriba').val();
			respu=cantidad/precioMonedaVenta;
			$('#campoAbajo').val(parseFloat(respu).toFixed(6));
		}else{
			cantidad=$('#campoAbajo').val();
			respu=cantidad*precioMonedaVenta;
			$('#campoArriba').val(parseFloat(respu).toFixed(2));
		}
		$('#spanMonedaLtr').text($('#selectCriptoMonedas').val());
		$('#spanPrecioVentaPub').text('S/. '+ parseFloat(precioMonedaVenta).toFixed(2));

		if( $('#selectCriptoMonedas').val()!='dolares'){
			$('#spanPrecioCompraPub').text('S/. '+ parseFloat(precioMonedaCompra).toFixed(2));
			$('#spanTipCambio').text(parseFloat(precioMonedaVenta).toFixed(2));}
		else{
			$('#spanPrecioCompraPub').text('S/. '+ parseFloat(precioMonedaCompra).toFixed(3));
			$('#spanTipCambio').text(parseFloat(precioMonedaVenta).toFixed(3));
		}
		
	}
	/*$('#campoArriba').change(function () {
		evaluarQueEstado(true); // TRUE para decir arriba cambió, false para abajo
	});*/
	$('#campoArriba').keyup(function (e) {
		var code = e.keyCode || e.which;
		if (code != '9') {
			evaluarQueEstado(true);
		}
	});
	$('#campoAbajo').keyup(function (e) {
		var code = e.keyCode || e.which;
		if (code != '9') {
			evaluarQueEstado(false);
		}
	});
	/*$('#campoAbajo').change(function () {
		evaluarQueEstado(false); // TRUE para decir arriba cambió, false para abajo
	});*/
	$('#btnCambiar').click(function () {
		$('#btnCambiar').toggleClass('fisico');
		var divArriba= $('#divTop').html();
		var divAbajo= $('#divBottom').html();
		$('#divTop').empty().html(divAbajo);
		$('#divBottom').empty().html(divArriba);

		evaluarQueEstado(true);
	});
	$('.contenedorLabels').on('change', '#selectCriptoMonedas', function () {
		evaluarQueEstado(true);
	});
});

</script>